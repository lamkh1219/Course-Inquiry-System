<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班級課堂與教師查詢系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #2c3e50;
            margin-top: 30px;
            border-left: 5px solid #3498db;
            padding-left: 10px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
        }
        .select-group {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap; /* 允許換行 */
        }
        .input-full-width {
            flex: 1 1 100%; /* 佔滿整行 */
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        label {
            font-weight: bold;
            margin-right: 5px;
            /* 讓標籤在輸入框寬度改變時不會太快換行 */
            white-space: nowrap; 
        }
        /* 統一所有輸入框的樣式，使其寬度一致且具彈性 */
        select, input[type="text"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            min-width: 150px;
            flex-grow: 1; /* 讓輸入框佔用剩餘空間，確保寬度一致 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: white;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .teacher-table th {
             background-color: #2ecc71; /* 綠色，區分查詢 */
        }
        #teacher-schedule-output td:last-child {
            background-color: #e6f7ff; /* 突出顯示空閒教師列表 */
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        /* 多教師查詢時的分隔標頭 */
        .teacher-header-row {
            background-color: #ffe082 !important; 
            font-weight: bold;
            text-align: center;
        }
        .teacher-header-row td {
            font-size: 1.1em;
        }
        #result-message, #teacher-result-message {
            margin-top: 15px;
            font-style: italic;
            font-weight: bold;
            color: #2980b9;
        }
    </style>
</head>
<body>

    <h1>班級課堂與教師查詢系統</h1>
    <p style="color: green;">✅ 正在自動載入 **`班別時間總表.csv`**、**`S&PSM_L.csv`**、**`Teacher List.csv`** 和 **`時間表.csv`** 檔案...</p>

    <div class="controls">
        <div class="select-group">
            <label for="day-select">共同選擇日子:</label>
            <select id="day-select" disabled>
                <option>載入中...</option>
            </select>
        </div>
    </div>
    
    <hr>
    <h2>1. 教師空閒查詢 (Teacher Free Time Lookup)</h2>
    <p>ℹ️ **P Grade**/<span style="color: red; font-weight: bold;">紅色</span>，**S Grade**/<span style="color: blue; font-weight: bold;">藍色</span>。優先代課老師以 <span style="color: orange; font-weight: bold;">橙色</span> 顯示並排最前。</p>
    
    <div class="controls">
        <div class="input-full-width">
            <label for="teacher-name-input">輸入需要課堂調動教師姓名:</label>
            <input type="text" id="teacher-name-input" placeholder="例如: 婷 鴻" disabled>
        </div>
        
        <div class="input-full-width">
            <label for="priority-teacher-input" style="color: orange;">優先代課老師名單 (橙色，排最前):</label>
            <input type="text" id="priority-teacher-input" placeholder="例如: 雅 魏" disabled>
        </div>
        
        <div class="input-full-width">
            <label for="duty-teacher-input" style="color: #900;">已有公務老師名單 (排除名單):</label>
            <input type="text" id="duty-teacher-input" placeholder="例如: 盧 欣" disabled>
        </div>
    </div>
    
    <div id="teacher-schedule-output">
        <table class="teacher-table">
            <thead>
                <tr>
                    <th>節數</th>
                    <th>時間</th>
                    <th>班別</th>
                    <th>課堂</th>
                    <th>空閒教師 (可代課名單) - 按優先級及空堂數排序</th>
                </tr>
            </thead>
            <tbody id="teacher-schedule-body">
                <tr><td colspan="5" style="text-align: center;">請輸入教師姓名並選擇日子</td></tr>
            </tbody>
        </table>
        <p id="teacher-result-message"></p>
    </div>

    
    <hr>
    <h2>2. 班級課表查詢 (Class Schedule Lookup)</h2>
    <p>ℹ️ **P Grade** 教師以 <span style="color: red; font-weight: bold;">紅色</span> 顯示，**S Grade** 教師以 <span style="color: blue; font-weight: bold;">藍色</span> 顯示。</p>
    
    <div class="controls">
        <div class="select-group">
            <label for="class-select">選擇班別:</label>
            <select id="class-select" disabled>
                <option>載入中...</option>
            </select>
        </div>
    </div>

    <div id="schedule-output">
        <table>
            <thead>
                <tr>
                    <th>節數</th>
                    <th>時間</th>
                    <th>課堂</th>
                    <th>上課教師</th>
                </tr>
            </thead>
            <tbody id="schedule-body">
                <tr><td colspan="4" style="text-align: center;">數據載入中，請稍候...</td></tr>
            </tbody>
        </table>
        <p id="result-message"></p>
    </div>


    <script>
        const CSV_FILE_PATH = "班別時間總表.csv"; 
        const GRADE_FILE_PATH = "S&PSM_L.csv"; 
        const TEACHER_LIST_FILE_PATH = "Teacher List.csv";
        const TIMETABLE_FILE_PATH = "時間表.csv"; // 新增檔案路徑

        let scheduleData = []; 
        let teacherGradesMap = new Map(); 
        let teacherListCache = []; 
        let timetableMap = new Map(); // 新增時間到節數的對應表
        
        // DOM 元素引用
        const daySelect = document.getElementById('day-select');
        const classSelect = document.getElementById('class-select');
        const scheduleBody = document.getElementById('schedule-body');
        const resultMessage = document.getElementById('result-message');
        
        const teacherNameInput = document.getElementById('teacher-name-input');
        const teacherScheduleBody = document.getElementById('teacher-schedule-body');
        const teacherResultMessage = document.getElementById('teacher-result-message');
        
        const priorityTeacherInput = document.getElementById('priority-teacher-input');
        const dutyTeacherInput = document.getElementById('duty-teacher-input');
        
        // ====================================================================
        // 核心輔助功能 (保持不變)
        // ====================================================================

        function timeToMinutes(timeString) {
            if (!timeString || typeof timeString !== 'string') return 0;
            const startTime = timeString.split('-')[0].trim(); 
            const parts = startTime.split(':');
            if (parts.length !== 2) return 0;
            
            const hours = parseInt(parts[0], 10);
            const minutes = parseInt(parts[1], 10);
            return hours * 60 + minutes;
        }

        function splitTeacherList(teacherString) {
            if (!teacherString) return [];
            return String(teacherString)
                .split(/[\s,，\/\／+]+/) 
                .map(name => name.trim()) 
                .filter(name => name.length > 0);
        }

        function getStyledTeacherName(teacherName) {
            if (!teacherName || teacherName === '---') return teacherName;

            const grade = teacherGradesMap.get(teacherName);
            let colorStyle = '';

            if (grade === 'P') {
                colorStyle = 'color: red; font-weight: bold;';
            } else if (grade === 'S') {
                colorStyle = 'color: blue; font-weight: bold;';
            }

            if (colorStyle) {
                return `<span style="${colorStyle}">${teacherName}</span>`;
            }
            return teacherName;
        }

        function getFreeListStyledTeacherName(teacherName, isPriority) {
            if (!teacherName || teacherName === '---') return teacherName;

            let color = 'inherit'; 
            
            if (isPriority) {
                color = 'orange'; 
            } else {
                const grade = teacherGradesMap.get(teacherName);
                if (grade === 'P') {
                    color = 'red';
                } else if (grade === 'S') {
                    color = 'blue';
                }
            }

            if (color !== 'inherit') {
                return `<span style="color: ${color}; font-weight: bold;">${teacherName}</span>`;
            }
            return teacherName;
        }

        function getAllTeachers() {
            return teacherListCache; 
        }

        function getOccupiedTeachers(day, time) {
            const occupiedSet = new Set();
            scheduleData.forEach(item => {
                if (item['日子'] === day && item['時間'] === time) {
                    if (item['上課教師']) {
                        const teachingNames = splitTeacherList(item['上課教師']);
                        teachingNames.forEach(name => occupiedSet.add(name));
                    }
                }
            });
            return occupiedSet;
        }

        function calculateDailyFreeLessons(day) {
            const excludedLessons = ['班主任課', '小息', '午餐'];
            
            const relevantUniqueTimeSlots = [...new Set(scheduleData
                .filter(item => 
                    item['日子'] === day && 
                    !excludedLessons.includes(item['課堂'])
                )
                .map(item => item['時間']))
            ];

            const allTeachers = getAllTeachers(); 
            const freeLessonCountMap = new Map();

            allTeachers.forEach(teacher => {
                freeLessonCountMap.set(teacher, 0);
            });

            relevantUniqueTimeSlots.forEach(timeSlot => {
                const occupiedSet = getOccupiedTeachers(day, timeSlot); 
                
                allTeachers.forEach(teacher => {
                    if (!occupiedSet.has(teacher)) {
                        freeLessonCountMap.set(teacher, freeLessonCountMap.get(teacher) + 1);
                    }
                });
            });

            return freeLessonCountMap;
        }
        
        // ====================================================================
        // 數據載入與初始化
        // ====================================================================

        function loadDataAndPopulateControls() {
             resultMessage.textContent = '載入排課表...'; 
             teacherResultMessage.textContent = '載入排課表...';
            loadTeacherList();
        }

        function loadTeacherList() {
            Papa.parse(TEACHER_LIST_FILE_PATH, {
                download: true,
                header: false, 
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: function(results) {
                    if (results.data.length > 0 && results.data[0].length > 0) {
                        teacherListCache = results.data
                            .map(row => String(row[0]).trim()) 
                            .filter(name => name.length > 0 && name !== 'Teacher List'); 

                        teacherResultMessage.textContent = `✅ 教師名單檔案載入成功 (共 ${teacherListCache.length} 位教師)。載入排課表...`;
                    } else {
                        teacherResultMessage.textContent = `⚠️ 教師名單檔案載入成功，但內容為空或格式不正確。載入排課表...`;
                    }
                    loadScheduleData();
                },
                error: function(err) {
                    console.error("PapaParse Teacher List Error:", err);
                    teacherResultMessage.textContent = `❌ 載入教師名單檔案失敗。請確認檔案 "${TEACHER_LIST_FILE_PATH}" 存在。載入排課表...`;
                    loadScheduleData();
                }
            });
        }


        function loadScheduleData() {
            Papa.parse(CSV_FILE_PATH, {
                download: true,         
                header: true,           
                skipEmptyLines: true,   
                dynamicTyping: true,    
                complete: function(results) {
                    scheduleData = results.data; 

                    if (scheduleData.length === 0 || !scheduleData[0]['日子'] || !scheduleData[0]['班別']) {
                        const errorMsg = "排課表檔案中沒有有效數據，或欄位標題不正確。";
                        console.error(errorMsg);
                        resultMessage.textContent = `❌ 數據載入失敗：${errorMsg}`;
                        disableAllControls();
                        return;
                    }
                    
                    resultMessage.textContent = '載入排課表成功。載入教師等級檔案...'; 
                    
                    if (teacherListCache.length === 0) {
                        teacherListCache = deriveTeachersFromSchedule();
                        teacherResultMessage.textContent += ` (備用: 從排課表推導出 ${teacherListCache.length} 位教師名單)`;
                    }

                    loadTeacherGrades();
                },
                error: function(err) {
                    console.error("PapaParse Schedule Error:", err);
                    resultMessage.textContent = `❌ 載入排課表檔案失敗。請確認檔案 "${CSV_FILE_PATH}" 存在。`;
                    teacherScheduleBody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: red;">排課表檔案載入失敗。</td></tr>`;
                    disableAllControls();
                }
            });
        }
        
        function deriveTeachersFromSchedule() {
            const teacherSet = new Set();
            scheduleData.forEach(item => {
                if (item['上課教師']) {
                    splitTeacherList(item['上課教師']).forEach(name => teacherSet.add(name));
                }
                if (item['可代課教師']) {
                    splitTeacherList(item['可代課教師']).forEach(name => teacherSet.add(name));
                }
            });
            return Array.from(teacherSet).filter(name => name !== '---' && name.length > 0);
        }

        function loadTeacherGrades() {
            Papa.parse(GRADE_FILE_PATH, {
                download: true,
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: function(gradeResults) {
                    if (gradeResults.data.length > 0 && gradeResults.data[0]['教師'] && gradeResults.data[0]['Grade']) {
                        gradeResults.data.forEach(item => {
                            if (item['教師'] && item['Grade']) {
                                teacherGradesMap.set(String(item['教師']).trim(), String(item['Grade']).trim());
                            }
                        });
                        teacherResultMessage.textContent += ' ✅ 教師等級檔案載入成功。';
                    } else {
                        teacherResultMessage.textContent += ` ⚠️ 教師等級檔案載入成功，但內容格式可能不正確。`;
                    }
                    
                    loadTimetableData(); // 繼續載入時間表
                },
                error: function(err) {
                    console.error("PapaParse Grade Error:", err);
                    teacherResultMessage.textContent += ` ❌ 載入教師等級檔案失敗。請確認檔案 "${GRADE_FILE_PATH}" 存在。`;
                    loadTimetableData(); // 繼續載入時間表
                }
            });
        }
        
        // 新增：載入時間表數據
        function loadTimetableData() {
            Papa.parse(TIMETABLE_FILE_PATH, {
                download: true,
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: function(timetableResults) {
                    if (timetableResults.data.length > 0 && timetableResults.data[0]['時間'] && timetableResults.data[0]['節數']) {
                        timetableResults.data.forEach(item => {
                            if (item['時間'] && item['節數']) {
                                timetableMap.set(String(item['時間']).trim(), String(item['節數']).trim());
                            }
                        });
                        teacherResultMessage.textContent += ' ✅ 節數時間表檔案載入成功。';
                    } else {
                        teacherResultMessage.textContent += ` ⚠️ 節數時間表檔案載入成功，但內容格式可能不正確。`;
                    }
                    
                    populateControls(); // 最後一步：填充控制項並顯示數據
                },
                error: function(err) {
                    console.error("PapaParse Timetable Error:", err);
                    teacherResultMessage.textContent += ` ❌ 載入節數時間表檔案失敗。請確認檔案 "${TIMETABLE_FILE_PATH}" 存在。`;
                    populateControls(); // 最後一步：填充控制項並顯示數據
                }
            });
        }


        function disableAllControls() {
            daySelect.disabled = true;
            classSelect.disabled = true;
            teacherNameInput.disabled = true; 
            priorityTeacherInput.disabled = true; 
            dutyTeacherInput.disabled = true; 
        }

        function populateControls() {
            daySelect.disabled = false;
            classSelect.disabled = false;
            teacherNameInput.disabled = false;
            priorityTeacherInput.disabled = false; 
            dutyTeacherInput.disabled = false;
            
            const allDays = [...new Set(scheduleData.map(item => item['日子']).filter(Boolean))];
            const allClasses = [...new Set(scheduleData.map(item => item['班別']).filter(Boolean))];

            populateSelect(daySelect, allDays, '日子');
            populateSelect(classSelect, allClasses, '班別');
            
            if (allDays.length > 0) daySelect.value = allDays[0];
            if (allClasses.length > 0) classSelect.value = allClasses[0];

            displayTeacherSchedule(); 
            displaySchedule();
        }

        function populateSelect(selectElement, options, name) {
            selectElement.innerHTML = ''; 
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `--- 請選擇 ${name} ---`;
            selectElement.appendChild(defaultOption);

            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                selectElement.appendChild(opt);
            });
        }
        
        // ====================================================================
        // 1. 教師空閒查詢 (已更新：新增節數欄位)
        // ====================================================================
        
        function displayTeacherSchedule() {
            if (scheduleData.length === 0 || teacherListCache.length === 0) {
                teacherResultMessage.textContent = '數據載入中，或教師名單為空。';
                teacherScheduleBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">請等待所有數據載入。</td></tr>`; // 欄位數改為 5
                return;
            }

            const selectedDay = daySelect.value;
            const rawInput = teacherNameInput.value.trim(); 
            const teacherNames = splitTeacherList(rawInput);
            
            const priorityTeachers = new Set(splitTeacherList(priorityTeacherInput.value.trim()));
            const dutyTeachers = new Set(splitTeacherList(dutyTeacherInput.value.trim()));

            teacherScheduleBody.innerHTML = '';
            teacherResultMessage.textContent = '';

            if (!selectedDay) {
                 teacherResultMessage.textContent = '請先選擇日子。';
                 teacherScheduleBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">請先選擇日子。</td></tr>`; // 欄位數改為 5
                 return;
            }

            if (teacherNames.length === 0) {
                teacherResultMessage.textContent = '請輸入教師姓名以查詢其課堂及空閒教師名單。';
                teacherScheduleBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">請輸入教師姓名。</td></tr>`; // 欄位數改為 5
                return;
            }
            
            let combinedTeacherLessons = [];
            const allTeachers = getAllTeachers(); 
            const dailyFreeLessonsMap = calculateDailyFreeLessons(selectedDay); 

            teacherNames.forEach(teacherName => {
                const targetTeacherLessons = scheduleData.filter(item => {
                    if (item['日子'] !== selectedDay) return false;
                    const teachingNames = splitTeacherList(item['上課教師']);
                    return teachingNames.includes(teacherName);
                });
                
                if (targetTeacherLessons.length > 0) {
                    
                    targetTeacherLessons.sort((a, b) => timeToMinutes(a['時間']) - timeToMinutes(b['時間']));
                    
                    const styledHeaderName = getStyledTeacherName(teacherName);
                    combinedTeacherLessons.push({ isHeader: true, name: styledHeaderName });
                    combinedTeacherLessons.push(...targetTeacherLessons);
                }
            });

            if (combinedTeacherLessons.length === 0) {
                teacherScheduleBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">在 ${selectedDay}，您查詢的教師 ${teacherNames.join('、')} 沒有任教課堂。</td></tr>`; // 欄位數改為 5
                return;
            }
            
            let totalLessonsCount = 0;
            combinedTeacherLessons.forEach(lesson => {
                if (lesson.isHeader) {
                    const row = teacherScheduleBody.insertRow();
                    row.className = 'teacher-header-row';
                    // 教師名稱佔 1 欄位，排課資訊佔剩餘 4 欄位 (時間, 班別, 課堂, 空閒教師)
                    row.insertCell().innerHTML = `教師: ${lesson.name}`; 
                    row.insertCell().colSpan = 4; // 欄位數改為 4
                    row.cells[0].colSpan = 1; 
                    row.cells[1].textContent = '該教師的排課';
                    return;
                }
                
                const row = teacherScheduleBody.insertRow();
                const lessonTime = lesson['時間'] || '---';
                const lessonNumber = timetableMap.get(lessonTime) || '---'; // 獲取節數

                totalLessonsCount++;
                
                const occupiedTeachers = getOccupiedTeachers(selectedDay, lessonTime);
                
                const freeTeachersNames = allTeachers.filter(teacher => 
                    !occupiedTeachers.has(teacher) && 
                    !teacherNames.includes(teacher) &&
                    !dutyTeachers.has(teacher)
                );

                const freeTeachersWithCount = freeTeachersNames.map(teacher => ({
                    name: teacher,
                    freeCount: dailyFreeLessonsMap.get(teacher) || 0 
                }));

                freeTeachersWithCount.sort((a, b) => {
                    const aIsPriority = priorityTeachers.has(a.name);
                    const bIsPriority = priorityTeachers.has(b.name);

                    if (aIsPriority && !bIsPriority) return -1;
                    if (!aIsPriority && bIsPriority) return 1;
                    
                    return b.freeCount - a.freeCount;
                });

                const freeTeachersString = freeTeachersWithCount
                    .map(item => {
                        const isPriority = priorityTeachers.has(item.name);
                        const styledName = getFreeListStyledTeacherName(item.name, isPriority);
                        return `${styledName} (${item.freeCount})`;
                    })
                    .join(', ');

                // 插入 5 個單元格：節數、時間、班別、課堂、空閒教師
                row.insertCell().textContent = lessonNumber; // 新增節數
                row.insertCell().textContent = lessonTime;
                row.insertCell().textContent = lesson['班別'] || '---';
                row.insertCell().textContent = lesson['課堂'] || '---';

                const freeTeachersCell = row.insertCell();
                freeTeachersCell.innerHTML = freeTeachersString || '無其他教師空閒';
            });
            
            teacherResultMessage.textContent = `✅ 成功顯示 ${selectedDay}，教師 ${teacherNames.join('、')} 的合併課堂安排 (共 ${totalLessonsCount} 節)。`;
        }


        // ====================================================================
        // 2. 班級課表查詢 (已更新：新增節數欄位)
        // ====================================================================

        function displaySchedule() {
            if (scheduleData.length === 0) return;

            const selectedDay = daySelect.value;
            const selectedClass = classSelect.value;

            scheduleBody.innerHTML = '';
            resultMessage.textContent = '';

            if (!selectedDay || !selectedClass) {
                resultMessage.textContent = '請選擇日子和班別以查看課表。';
                scheduleBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">請選擇日子和班別。</td></tr>`; // 欄位數改為 4
                return;
            }

            const filteredSchedule = scheduleData.filter(item => 
                item['日子'] === selectedDay && item['班別'] === selectedClass
            );

            if (filteredSchedule.length === 0) {
                resultMessage.textContent = `在 ${selectedDay}，${selectedClass} 班沒有找到課表數據。`;
                scheduleBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">在 ${selectedDay}，${selectedClass} 班沒有找到課表數據。</td></tr>`; // 欄位數改為 4
                return;
            }

            filteredSchedule.forEach(lesson => {
                const row = scheduleBody.insertRow();
                
                const getTime = lesson['時間'] || '---';
                const getLesson = lesson['課堂'] || '---';
                const getTeacher = lesson['上課教師'] || '---';
                const getLessonNumber = timetableMap.get(getTime) || '---'; // 獲取節數
                
                const styledTeachers = splitTeacherList(getTeacher)
                    .map(name => getStyledTeacherName(name))
                    .join(', ');

                // 插入 4 個單元格：節數、時間、課堂、上課教師
                row.insertCell().textContent = getLessonNumber; // 新增節數
                row.insertCell().textContent = getTime;
                row.insertCell().textContent = getLesson;
                row.insertCell().innerHTML = styledTeachers || '---'; 
            });
            
            resultMessage.textContent = `✅ 成功顯示 ${selectedDay}, ${selectedClass} 班的課表 (共 ${filteredSchedule.length} 節)。`;
        }


        // ====================================================================
        // 初始化和事件監聽
        // ====================================================================

        document.addEventListener('DOMContentLoaded', () => {
            daySelect.addEventListener('change', displaySchedule);
            classSelect.addEventListener('change', displaySchedule);
            
            daySelect.addEventListener('change', displayTeacherSchedule);
            teacherNameInput.addEventListener('input', displayTeacherSchedule); 
            priorityTeacherInput.addEventListener('input', displayTeacherSchedule); 
            dutyTeacherInput.addEventListener('input', displayTeacherSchedule); 
            
            loadDataAndPopulateControls();
        });

    </script>

</body>
</html>